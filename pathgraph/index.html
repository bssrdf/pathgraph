<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Path Graph</title>
    <link rel="stylesheet" href="Content/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="app.css" type="text/css" />
    <script src="Scripts/jquery-1.9.1.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/snap/snap.svg.js"></script>
    <script src="node_modules/knockout/build/output/knockout-latest.debug.js"></script>
    <script src="app.js"></script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <div id="content">
        <div class="page-header" id="header">
            <h1>Path Graph<small>Pretty visualizations for ray tracing algorithms.</small></h1>
        </div>
        <div id="workspace-main">
            <div id="workspace-left">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h2 class="panel-title"><a data-toggle="collapse" href="#settings-body">Settings</a></h2>
                    </div>
                    <div id="settings-body" class="panel-collapse collapse scroll-panel" style="margin-left: 10px;">
                        <div class="form-group">
                            <div class="checkbox">
                                <label><input type="checkbox" data-bind="checked: renderPathDensity">Render Path Density</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h2 class="panel-title"><a data-toggle="collapse" href="#objects-body">Objects</a></h2>
                    </div>

                    <div class="panel-body">
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Create <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="#" data-bind="click: function(d, e) { addShape(new Box(new Vec2(100, 100), new Vec2(30, 30), s)); }">Box</a></li>
                                <li><a href="#" data-bind="click: function(d, e) {addShape(new Circle(new Vec2(100, 100), 30, s)); }">Circle</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="#"data-bind="click: function(d, e) {addCamera(new Camera(new Vec2(100, 100), 0, s)); }">Camera</a></li>
                                <li><a href="#" data-bind="click: function(d, e) {addShape(new Light(new Vec2(100, 100), 4, s)); }">Light</a></li>
                            </ul>
                        </div>
                    </div>

                    <div id="objects-body" class="panel-collapse collapse scroll-panel">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Type</th>
                                    <th>Position</th>
                                    <th>Scale</th>
                                    <th>Rotation</th>
                                </tr>
                            </thead>
                            <!-- Todo: Generate table body -->
                            <tbody data-bind="foreach: cameras">
                                <tr>
                                    <td>
                                        <button type="button" data-bind="click: $parent.removeThing.bind($parent)" class="btn btn-danger btn-sm" aria-label="Left Align">
                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                    <td>
                                        <p>Camera</p>
                                    </td>
                                    <td data-bind="text: pos()"></td>
                                    <td data-bind="text: scale()"></td>
                                    <td><input data-bind="value: rot" /></td>
                                </tr>
                            </tbody>

                            <tbody data-bind="foreach: shapes">
                                <tr>
                                    <td>
                                        <button type="button" data-bind="click: $parent.removeThing.bind($parent)"" class="btn btn-danger btn-sm" aria-label="Left Align">
                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                    <td>
                                        <p>Shape</p>
                                    </td>
                                    <td data-bind="text: pos()"></td>
                                    <td data-bind="text: scale()"></td>
                                    <td><input data-bind="value: rot" /></td>
                                </tr>
                            </tbody>

                            <tbody data-bind="foreach: lights">
                                <tr>
                                    <td>
                                        <button type="button" data-bind="click: $parent.removeThing.bind($parent)"" class="btn btn-danger btn-sm" aria-label="Left Align">
                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                    <td>
                                        <p>Light</p>
                                    </td>
                                    <td data-bind="text: pos()"></td>
                                    <td data-bind="text: scale()"></td>
                                    <td><input data-bind="value: rot" /></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


            </div>
            <div id="workspace-center">
                <div id="svg-wrapper">
                    <canvas id="density"></canvas>
                    <svg id="svg-container" />
                </div>
                <br />
                <a target="_blank" onmousedown="saveSvg()" id="save-button" href="#" class="btn btn-default btn-lg btn-block">Save as SVG</a>
                <br />
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h2 class="panel-title"><a data-toggle="collapse" href="#code-body">Intersection Code</a></h2>
                    </div>
                    <div class="panel-body">
                        <code>function sampleDir(intersect, ray, scene) => [Vec2]</code>
                    </div>
                    <div id="code-body" class="panel-collapse collapse scroll-panel">
                        <div id="editor">return [cosineSampleHemisphere(intersect.n)];</div>
                    </div>
                    <div id="code-footer" class="panel-footer"></div>
                </div>
            </div>
            <div id="workspace-right">

            </div>
        </div>


    </div>

    <footer id="footer">
        <div class="container">
            <p class="text-muted text-center">Made by <a href="//darioseyb.com">Dario Seyb</a></p>
        </div>
    </footer>

    <ul id="contextMenu" class="dropdown-menu" role="menu" style="display:none">
        <li><a tabindex="-1" href="#">Action</a></li>
        <li><a tabindex="-1" href="#">Another action</a></li>
        <li><a tabindex="-1" href="#">Something else here</a></li>
        <li class="divider"></li>
        <li><a tabindex="-1" href="#">Separated link</a></li>
    </ul>

    <script src="node_modules/ace-builds/src/ace.js"></script>
    <script src="external.js"></script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.getSession().setMode("ace/mode/javascript");
        editor.getSession().on('change', function (e) {
            if (!sampleDirFunc) return;

            try {
                var intersectFunc = new Function("intersect", "ray", "scene", editor.getValue());
                sampleDirFunc(intersectFunc);
                $("#code-footer").text("No Errors");
                localStorage.setItem("sampleDirFunc", editor.getValue());
            }
            catch (syntaxError) {
                $("#code-footer").text(syntaxError.name + "-" + syntaxError.message);
            }
        });

        var savedData = localStorage.getItem("sampleDirFunc");

        if (savedData == "") {
            savedData = "return [reflect(ray.d, intersect.n)]";
        }

        editor.setValue(savedData);

        if (sampleDirFunc) {
            try {
                var intersectFunc = new Function("intersect", "ray", editor.getValue());
                sampleDirFunc(intersectFunc);
                $("#code-footer").text("No Errors");
            }
            catch (syntaxError) {
                $("#code-footer").text(syntaxError.name + "-" + syntaxError.message);
            }
        }

    </script>

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-36574384-2', 'auto');
        ga('send', 'pageview');

    </script>
</body>
</html>
